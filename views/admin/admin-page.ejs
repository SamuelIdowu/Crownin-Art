<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Page</title>
    <link rel="stylesheet" href="styles/admin.css" />
    <link rel="stylesheet" href="styles/fonts.css" />
    <link rel="stylesheet" href="styles/effects.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
  </head>
  <body>
    <%- include("../partials/header") -%>

    <div class="container">
      <!-- Sidebar -->
      <div class="sidenav">
        <div class="profile">
          <div class="avatar">
            <img
              src="https://hebbkx1anhila5yf.public.blob.vercel-storage.com/ap-JLtUJHpjreq63axqbTaj2FThjcmPch.png"
              alt="Admin Avatar"
            />
          </div>
          <h2>Hello, Admin</h2>
        </div>
        <nav class="nav-menu">
          <ul>
            <li class="active">
              <a href="#dashboard"><i class="fas fa-home"></i> Dashboard</a>
            </li>
            <li>
              <a href="#catalogue"><i class="fas fa-book"></i> Catalogue</a>
            </li>
            <li>
              <a href="#listings"><i class="fas fa-list"></i> Listings</a>
            </li>
            <li>
              <a href="#gallery"><i class="fas fa-images"></i> Gallery</a>
            </li>
            <li>
              <a href="#exhibitions"
                ><i class="fas fa-calendar-alt"></i> Exhibitions</a
              >
            </li>
            <li>
              <a href="/login"><i class="fas fa-sign-out-alt"></i> Logout</a>
            </li>
          </ul>
        </nav>
      </div>

      <!-- Main Content -->
      <div class="main-content">
        <div class="content-area">
          <!-- Dashboard Section -->
          <div id="dashboard-section" class="section active">
            <h1>Dashboard</h1>
            <div class="dashboard-stats">
              <div class="stat-card">
                <div class="stat-icon"><i class="fas fa-book"></i></div>
                <div class="stat-info">
                  <h3>Catalogue Items</h3>
                  <p><%= catalogues.length %></p>
                </div>
              </div>
              <div class="stat-card">
                <div class="stat-icon"><i class="fas fa-list"></i></div>
                <div class="stat-info">
                  <h3>Listings</h3>
                  <p><%= listings.length %></p>
                </div>
              </div>
              <div class="stat-card">
                <div class="stat-icon"><i class="fas fa-images"></i></div>
                <div class="stat-info">
                  <h3>Gallery Items</h3>
                  <p><%= gallery.length %></p>
                </div>
              </div>
              <div class="stat-card">
                <div class="stat-icon"><i class="fas fa-calendar-alt"></i></div>
                <div class="stat-info">
                  <h3>Exhibitions</h3>
                  <p><%= exhibitions.length %></p>
                </div>
              </div>
            </div>
          </div>

          <!-- Catalogue Section -->
          <div id="catalogue-section" class="section">
            <div class="section-header">
              <h1>Catalogue Management</h1>
              <a href="/post" class="add-btn">
                <i class="fas fa-plus"></i> Add New
              </a>
            </div>
            <div class="table-container">
              <table class="data-table">
                <thead>
                  <tr>
                    <th>S.N.</th>
                    <th>Image</th>
                    <th>Title</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody id="catalogue-table-body">
                  <% catalogues.forEach((item, index) => { %>
                  <tr>
                    <td><%= index + 1 %></td>
                    <td>
                      <img
                        src="<%= item.image %>"
                        alt="<%= item.title %>"
                        class="item-image"
                      />
                    </td>
                    <td><%= item.title %></td>
                    <td class="action-buttons">
                      <button
                        class="delete-btn"
                        data-id="<%= item._id %>"
                        data-type="catalogue"
                      >
                        <i class="fas fa-trash"></i> Delete
                      </button>
                    </td>
                  </tr>
                  <% }); %>
                </tbody>
              </table>
            </div>
          </div>

          <!-- Listings Section -->
          <div id="listings-section" class="section">
            <div class="section-header">
              <h1>Listings Management</h1>
              <a href="/post" class="add-btn">
                <i class="fas fa-plus"></i> Add New
              </a>
            </div>
            <div class="table-container">
              <table class="data-table">
                <thead>
                  <tr>
                    <th>S.N.</th>
                    <th>Image</th>
                    <th>Title</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody id="listings-table-body">
                  <% listings.forEach((item, index) => { %>
                  <tr>
                    <td><%= index + 1 %></td>
                    <td>
                      <img
                        src="<%= item.image %>"
                        alt="<%= item.title %>"
                        class="item-image"
                      />
                    </td>
                    <td><%= item.title %></td>
                    <td class="action-buttons">
                      <button
                        class="delete-btn"
                        data-id="<%= item._id %>"
                        data-type="listings"
                      >
                        <i class="fas fa-trash"></i> Delete
                      </button>
                    </td>
                  </tr>
                  <% }); %>
                </tbody>
              </table>
            </div>
          </div>

          <!-- Gallery Section -->
          <div id="gallery-section" class="section">
            <div class="section-header">
              <h1>Gallery Management</h1>
              <a href="/post" class="add-btn">
                <i class="fas fa-plus"></i> Add New
              </a>
            </div>
            <div class="gallery-grid" id="gallery-items">
              <% gallery.forEach((item) => { %>
              <div class="gallery-item">
                <img src="<%= item.image %>" alt="<%= item.title %>" />
                <div class="gallery-item-actions">
                  <button class="edit-btn"><i class="fas fa-edit"></i></button>
                  <button
                    class="delete-btn"
                    data-id="<%= item._id %>"
                    data-type="gallery"
                  >
                    <i class="fas fa-trash"></i>
                  </button>
                </div>
              </div>
              <% }); %>
            </div>
          </div>

          <!-- Exhibitions Section -->
          <div id="exhibitions-section" class="section">
            <div class="section-header">
              <h1>Exhibitions Management</h1>
              <a href="/post" class="add-btn">
                <i class="fas fa-plus"></i> Add New
              </a>
            </div>
            <div class="exhibitions-list" id="exhibitions-items">
              <% exhibitions.forEach((item) => { %>
              <div class="exhibition-item">
                <img src="<%= item.image %>" alt="<%= item.title %>" />
                <div class="exhibition-info">
                  <h3><%= item.title %></h3>
                  <p><%= item.description %></p>
                  <div class="exhibition-actions">
                    <button class="edit-btn">
                      <i class="fas fa-edit"></i> Edit
                    </button>
                    <button
                      class="delete-btn"
                      data-id="<%= item._id %>"
                      data-type="exhibition"
                    >
                      <i class="fas fa-trash"></i> Delete
                    </button>
                  </div>
                </div>
              </div>
              <% }); %>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="delete-modal" class="modal">
      <div class="modal-content">
        <span class="close">&times;</span>
        <h2>Confirm Deletion</h2>
        <p>
          Are you sure you want to delete this item? This action cannot be
          undone.
        </p>
        <div class="modal-actions">
          <button id="cancel-delete" class="cancel-btn">Cancel</button>
          <button id="confirm-delete" class="delete-btn">Delete</button>
        </div>
      </div>
    </div>

    <script>
      // DOM Elements
      const navLinks = document.querySelectorAll(".nav-menu a");
      const sections = document.querySelectorAll(".section");
      const modal = document.getElementById("delete-modal");
      const closeModalBtn = document.querySelector(".close");
      const cancelDeleteBtn = document.getElementById("cancel-delete");
      const confirmDeleteBtn = document.getElementById("confirm-delete");

      // Current item to delete
      let currentDeleteItem = {
        type: null,
        id: null,
      };

      // Initialize the admin panel
      document.addEventListener("DOMContentLoaded", function () {
        // Add event listeners for navigation
        navLinks.forEach((link) => {
          link.addEventListener("click", function (e) {
            e.preventDefault();

            // Remove active class from all links
            navLinks.forEach((link) =>
              link.parentElement.classList.remove("active")
            );

            // Add active class to clicked link
            this.parentElement.classList.add("active");

            // Get the section id from the href attribute
            const sectionId =
              this.getAttribute("href").substring(1) + "-section";

            // Show the corresponding section
            showSection(sectionId);
          });
        });

        // Modal event listeners
        closeModalBtn.addEventListener("click", closeModal);
        cancelDeleteBtn.addEventListener("click", closeModal);
        confirmDeleteBtn.addEventListener("click", confirmDelete);

        // Close modal when clicking outside
        window.addEventListener("click", function (e) {
          if (e.target === modal) {
            closeModal();
          }
        });

        showSection("dashboard-section");
      });

      function showSection(sectionId) {
        sections.forEach((section) => {
          section.classList.remove("active");
        });
        document.getElementById(sectionId).classList.add("active");
      }

      // Modal handling functions
      function openDeleteModal(type, id) {
        currentDeleteItem.type = type;
        currentDeleteItem.id = id;
        modal.style.display = "block";
      }

      function closeModal() {
        modal.style.display = "none";
      }

      function confirmDelete() {
        console.log(
          `Deleting ${currentDeleteItem.type} item ${currentDeleteItem.id}`
        );
        closeModal();
        window.location.reload();
      }

      document.addEventListener("DOMContentLoaded", () => {
        document.querySelectorAll(".delete-btn").forEach((button) => {
          button.addEventListener("click", async function (e) {
            e.preventDefault();
            const itemId = this.dataset.id;
            const itemType = this.dataset.type;

            if (
              confirm(`Are you sure you want to delete this ${itemType} item?`)
            ) {
              try {
                const response = await fetch(`/api/${itemType}/${itemId}`, {
                  method: "DELETE",
                  headers: {
                    "Content-Type": "application/json",
                  },
                });

                if (response.ok) {
                  if (itemType === "catalogue" || itemType === "listings") {
                    this.closest("tr").remove();
                  } else if (itemType === "gallery") {
                    this.closest(".gallery-item").remove();
                  } else if (itemType === "exhibition") {
                    this.closest(".exhibition-item").remove();
                  }
                } else {
                  const error = await response.json();
                  alert(`Delete failed: ${error.error}`);
                }
              } catch (error) {
                console.error("Delete error:", error);
                alert("Error deleting item. Please try again.");
              }
            }
          });
        });
      });
    </script>

    <%- include("../partials/footer") -%>
  </body>
</html>
